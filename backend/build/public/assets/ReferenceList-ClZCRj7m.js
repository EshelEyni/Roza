import{A as p,c as u,j as e,M as y,z as N,r as j,e as S,i as A,w as z,F,G as L}from"./index-BnA0ap6K.js";import{P,D as b,a as T}from"./PageTitle-Vu_PU7SK.js";import{T as k}from"./TextElement-qOP0c2bH.js";import{H as w,M as h,I as H}from"./Input-f5-EZKHG.js";import{u as O,S as E}from"./SlateEditor-D5fy1hEl.js";import{a as g}from"./P-DF0eyyfW.js";import{B as f,H as B,c as W}from"./PageContent-ihS0kPnQ.js";const ae=({isEdit:i=!1})=>{const{bookReview:t,isSuccessBookReview:s,onNavigateToEdit:n,onArchiveBookReview:l,updateBookReview:a}=p(),{t:c}=u();function r(m){if(!t)return;const x=m.target.value;a({...t,name:x})}return!s||!t?null:e.jsx(P,{isEdit:i,entityType:"review",entityName:t.name,handleInputChange:r,onNavigateToEdit:n,modalName:"archiveReview",onDeleteEntity:l,archiveTitle:c("archiveReviewMsg.title"),archiveMsg:c("archiveReviewMsg.msg")})},v=({textEl:i,maxLength:t=y,text:s})=>{const{elMaxWidth:n}=O({width:1e3});function l(){return s||(i?N(i):"")}const a=l(),c=a.length>t?a.slice(0,t)+"...":a;return e.jsx("p",{className:"w-full whitespace-pre-wrap break-words text-base text-app-700",style:{maxWidth:n},children:c})},M=({isMinimized:i,onToggleMinimize:t,text:s})=>{const{t:n}=u(),a=(s?N(s).length:0)<y;return s&&a?null:e.jsx(f,{onClick:t,isSmall:!0,children:n(i?"btnMaximize":"btnMinimize")})};function R({isMinimizedProp:i}){const[t,s]=j.useState(!1);return j.useEffect(()=>{s(i)},[i]),{isMinimized:t,setIsMinimized:s}}const G=({review:i})=>{const{loggedInUser:t}=S(),{updateBookReviewEntity:s,getReviewNumber:n}=p(),l=n(i.id),{isMinimized:a,setIsMinimized:c}=R({isMinimizedProp:i.isMinimized}),r=i.createdAt?A(i.createdAt,(t==null?void 0:t.language)||"en"):null,{t:m}=u();function x(){c(!a);const d={...i,isMinimized:!i.isMinimized};s({type:"updateReview",review:d})}return e.jsxs("section",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(w,{children:[m("review")," ",l]}),e.jsx(M,{isMinimized:i.isMinimized,onToggleMinimize:x,text:i.text})]}),a?e.jsx(v,{textEl:i.text}):e.jsx(e.Fragment,{children:i.text.map((d,o)=>e.jsx(k,{element:d},o))}),e.jsxs("div",{className:"mx-2 flex gap-1 italic text-app-600",children:[e.jsxs("span",{children:[m("createdAt"),":"]}),e.jsx("span",{children:r})]})]})},_=({review:i})=>{const{bookReview:t,updateBookReviewEntity:s,getReviewNumber:n}=p(),l=n(i.id),{t:a}=u(),{isMinimized:c,setIsMinimized:r}=R({isMinimizedProp:i.isMinimized});function m(o){const D={...i,text:o};s({type:"updateReview",review:D})}function x(o){s({type:"removeReview",reviewId:o})}function d(){r(!c);const o={...i,isMinimized:!i.isMinimized};s({type:"updateReview",review:o})}return e.jsxs("section",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"mb-3 flex items-center justify-between",children:[e.jsxs(w,{children:[a("review")," ",l]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(b,{isSmallOpenBtn:!0,modalName:"archiveReview",onDeleteEntity:()=>x(i.id),archiveTitle:a("removeReviewMsg.title"),archiveMsg:a("removeReviewMsg.msg")}),e.jsx(M,{isMinimized:i.isMinimized,onToggleMinimize:d})]})]}),c?e.jsx(v,{textEl:i.text}):e.jsx(E,{initialValue:i.text,onChange:z(o=>m(o),500).debouncedFunc,fullScreenTitle:(t==null?void 0:t.name)||a("bookReview")}),e.jsx(g,{})]})},I=({isMinimized:i,onToggleMinimize:t})=>{const{t:s}=u();return e.jsx(f,{onClick:t,isSmall:!0,children:s(i?"btnMaximizeAll":"btnMinimizeAll")})},le=({reviews:i,isEdit:t})=>{const{bookReview:s,updateBookReview:n,updateBookReviewEntity:l,onNavigateToEdit:a}=p(),{t:c}=u(),r=i.every(o=>o.isMinimized);function m(){l({type:"addReview"}),t||a()}function x(){l({type:"toggleMinimizeReviews",isMinimized:!r})}function d(o){s&&n({...s,reviews:o})}return e.jsxs("section",{className:"w-full font-normal text-app-800",children:[e.jsxs("div",{className:"mb-1 flex items-center justify-between",children:[e.jsx(B,{children:c("reviews")}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(I,{isMinimized:r,onToggleMinimize:x}),e.jsx(f,{onClick:m,isSmall:!0,children:c("btnAdd")})]})]}),e.jsx(g,{}),e.jsx(T,{listClassName:"flex flex-col gap-2",items:i,renderItem:o=>t?e.jsx(_,{review:o}):e.jsx(G,{review:o}),dragEndCallback:d})]})},$="dng9sfzqt",V="hoav12li",q=async(i,t)=>{const s=`https://api.cloudinary.com/v1_1/${$}/${t}/upload`,n=new FormData;n.append("file",i),n.append("upload_preset",V);try{const{data:l}=await F.post(s,n);return l.url}catch(l){return console.error("ERROR!",l),""}},X=({reference:i})=>{const[t,s]=j.useState(!1),{t:n}=u(),{updateBookReviewEntity:l}=p();async function a(c){if(!c.target.files)return;s(!0);const r=await q(c.target.files[0],"image");s(!1),l({type:"updateReference",reference:{...i,imgs:[...i.imgs,r]}})}return e.jsxs("div",{className:"flex items-center justify-end",children:[e.jsx(f,{disabled:t,isSmall:!0,children:e.jsx("label",{htmlFor:`img-input-${i.id}`,className:"cursor-pointer",children:t?e.jsx("span",{children:n("loading")}):e.jsx("span",{children:n("addImage")})})}),e.jsx("input",{id:`img-input-${i.id}`,type:"file",multiple:!1,onChange:a,className:"hidden",accept:"image/*"})]})};function Z(i){return L({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M289.94 256l95-95A24 24 0 00351 127l-95 95-95-95a24 24 0 00-34 34l95 95-95 95a24 24 0 1034 34l95-95 95 95a24 24 0 0034-34z"}}]})(i)}const J=({reference:i,img:t})=>{const[s,n]=j.useState(!1),{updateBookReviewEntity:l}=p(),{t:a}=u();function c(){l({type:"updateReference",reference:{...i,imgs:i.imgs.filter(r=>r!==t)}}),n(!1)}return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"relative",children:[e.jsxs(h,{children:[e.jsx(h.OpenBtn,{modalName:"imgDisplay",className:"absolute right-0 top-0 z-10 m-1 cursor-pointer rounded-full bg-app-800 p-1 text-white",children:e.jsx("span",{children:e.jsx(Z,{})})}),e.jsx(h.Window,{name:"imgDisplay",children:e.jsx("div",{className:"flex w-full flex-col gap-4",children:e.jsxs("div",{className:"flex w-full flex-col gap-2",children:[e.jsx("h3",{className:"text-center text-2xl font-medium text-app-800",children:a("removeImgMsg.title")}),e.jsx("p",{children:a("removeImgMsg.msg")}),e.jsxs("div",{className:"mt-4 flex items-center justify-center gap-2",children:[e.jsx(h.CloseBtn,{children:e.jsx("span",{children:a("btnCancel")})}),e.jsx(f,{onClick:c,children:e.jsx("span",{children:a("btnDelete")})})]})]})})})]}),e.jsx("img",{src:t,alt:"book reference",className:"h-48 w-auto cursor-pointer rounded-2xl object-fill",onClick:()=>n(!0)})]}),s&&e.jsx("img",{src:t,alt:"book reference",className:"fixed left-1/2 top-1/2 z-50 h-4/5  w-auto -translate-x-1/2 -translate-y-1/2 cursor-pointer rounded-2xl object-fill",onClick:()=>n(!1)})]})},C=({reference:i,imgs:t})=>e.jsx("ul",{className:"flex flex-wrap gap-2",children:t.map((s,n)=>e.jsx("li",{children:e.jsx(J,{reference:i,img:s})},n))}),K=({reference:i})=>{const{bookReview:t,updateBookReviewEntity:s}=p(),{t:n}=u(),{isMinimized:l,setIsMinimized:a}=R({isMinimizedProp:i.isMinimized});function c(d){s({type:"updateReference",reference:{...i,pages:d.target.value}})}function r(d){const o={...i,text:d};s({type:"updateReference",reference:o})}function m(){a(!l);const d={...i,isMinimized:!i.isMinimized};s({type:"updateReference",reference:d})}function x(){s({type:"removeReference",referenceId:i.id})}return i?e.jsxs("section",{className:"flex flex-col gap-3",children:[e.jsx(g,{}),e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsx(H,{type:"text",defaultValue:i.pages,placeholder:n("pages"),className:W("w-full rounded-md border border-app-800 px-1 py-2 text-center text-app-700",{"max-w-[150px]":!l,"max-w-[100px]":l}),onChange:d=>z(o=>c(o),500).debouncedFunc(d)}),l&&e.jsx(v,{textEl:i.text,maxLength:50}),e.jsxs("div",{className:"flex items-center gap-3",children:[!l&&e.jsx(X,{reference:i}),e.jsx(M,{isMinimized:i.isMinimized,onToggleMinimize:m})]})]}),!l&&e.jsxs(e.Fragment,{children:[e.jsx(E,{initialValue:i.text,onChange:z(d=>r(d),500).debouncedFunc,fullScreenTitle:(t==null?void 0:t.name)||n("bookReview")}),e.jsx(C,{reference:i,imgs:i.imgs}),e.jsx("div",{className:"flex items-center justify-end gap-3",children:e.jsx(b,{isSmallOpenBtn:!0,archiveTitle:n("removeReferenceMsg.title"),archiveMsg:n("removeReferenceMsg.msg"),modalName:"deleteReference",onDeleteEntity:x})})]})]}):null},Q=({reference:i})=>{const{updateBookReviewEntity:t}=p(),{isMinimized:s,setIsMinimized:n}=R({isMinimizedProp:i.isMinimized});function l(){n(!s);const a={...i,isMinimized:!i.isMinimized};t({type:"updateReference",reference:a})}return i?e.jsxs("section",{children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(w,{children:i.pages}),s?e.jsx(v,{textEl:i.text,maxLength:50}):e.jsx(e.Fragment,{children:i.text.map((a,c)=>e.jsx(k,{element:a},c))})]}),e.jsx(M,{isMinimized:i.isMinimized,onToggleMinimize:l})]}),!s&&e.jsx(C,{reference:i,imgs:i.imgs}),e.jsx(g,{})]}):null},oe=({references:i,isEdit:t=!1})=>{const{bookReview:s,updateBookReview:n,updateBookReviewEntity:l,onNavigateToEdit:a}=p(),{t:c}=u(),r=i.every(o=>o.isMinimized);function m(){l({type:"addReference"}),t||a()}function x(){l({type:"toggleMinimizeReferences",isMinimized:!r})}function d(o){s&&n({...s,references:o})}return e.jsxs("div",{className:"w-full font-normal text-app-800",children:[e.jsxs("div",{className:"mb-1 flex items-center justify-between",children:[e.jsx(B,{children:c("references")}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(I,{isMinimized:r,onToggleMinimize:x}),e.jsx(f,{onClick:m,isSmall:!0,children:c("btnAdd")})]})]}),e.jsx(g,{}),e.jsx(T,{listClassName:"flex flex-col gap-2",items:i,renderItem:o=>t?e.jsx(K,{reference:o}):e.jsx(Q,{reference:o}),dragEndCallback:d})]})};export{ae as B,le as R,oe as a};
