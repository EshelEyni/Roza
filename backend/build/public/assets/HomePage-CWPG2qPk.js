import{u as h,a as j,b as w,c as b,j as e,d as Q,e as G,f as O,g as z,r as W,h as J,L as K}from"./index-BnA0ap6K.js";import{u as S,F as C,I as d,R as m}from"./ReactHookFormInput-DRzq2zkO.js";import{E,B as y,M as X,P as Y}from"./PageContent-ihS0kPnQ.js";import{H as F,P as Z,a as f}from"./P-DF0eyyfW.js";import{B as _}from"./BookList-B-5W8_Sw.js";import{B as $}from"./BookReviewList-D6BPGLM9.js";import"./Article-bNPJyB0o.js";import"./Input-f5-EZKHG.js";import"./EntityListTitleContainer-B5IRMdBa.js";function ee(){const n=h(),{mutate:o,isPending:a,isError:i,error:s}=j({mutationFn:async r=>w.login(r.username,r.password),onSuccess:r=>{n.setQueryData(["loggedInUser"],r)}});return{login:o,isPendingLogin:a,isErrorLogin:i,errorLogin:s}}const se=()=>{const{login:n,isPendingLogin:o,isErrorLogin:a,errorLogin:i}=ee(),{t:s}=b(),{register:r,handleSubmit:u,formState:{errors:t},trigger:l}=S(),c=g=>{n(g)};return e.jsxs(C,{onSubmit:u(c),children:[e.jsx(F,{addedClass:"text-center",children:s("login")}),e.jsx(d,{label:s("username"),fieldError:t.username,htmlFor:"username",children:e.jsx(m,{register:r,name:"username",required:s("formValidation.mandatory.username"),placeholder:s("username"),trigger:l})}),e.jsx(d,{label:s("password"),fieldError:t.password,htmlFor:"password",children:e.jsx(m,{register:r,name:"password",type:"password",required:s("formValidation.mandatory.password"),placeholder:s("password"),trigger:l})}),a&&e.jsx(E,{msg:i==null?void 0:i.message}),e.jsx(y,{type:"submit",disabled:o,addedClassName:"self-center",children:s(o?"loggingIn":"login")})]})};function re(){const n=h(),{mutate:o,isPending:a,isError:i,error:s}=j({mutationFn:async r=>w.signup(r),onSuccess:r=>{n.setQueryData(["loggedInUser"],r)}});return{signup:o,isPendingSignup:a,isErrorSignup:i,errorSignup:s}}const oe=()=>{const{signup:n,isPendingSignup:o,isErrorSignup:a,errorSignup:i}=re(),{t:s}=b(),{register:r,handleSubmit:u,formState:{errors:t},trigger:l}=S(),c=g=>{n(g)};return e.jsxs(C,{onSubmit:u(c),children:[e.jsx(F,{addedClass:"text-center",children:s("signup")}),e.jsx(d,{label:s("username"),fieldError:t.username,htmlFor:"username",children:e.jsx(m,{register:r,name:"username",required:s("formValidation.mandatory.username"),placeholder:s("username"),trigger:l})}),e.jsx(d,{label:s("fullName"),fieldError:t.fullname,htmlFor:"fullname",children:e.jsx(m,{register:r,name:"fullname",required:s("formValidation.mandatory.fullname"),placeholder:s("fullName"),trigger:l})}),e.jsx(d,{label:s("email"),fieldError:t.email,htmlFor:"email",children:e.jsx(m,{register:r,name:"email",required:s("formValidation.mandatory.email"),placeholder:s("email"),trigger:l})}),e.jsx(d,{label:s("password"),fieldError:t.password,htmlFor:"password",children:e.jsx(m,{register:r,name:"password",type:"password",required:s("formValidation.mandatory.password"),placeholder:s("password"),trigger:l})}),e.jsx(d,{label:s("passwordConfirm"),fieldError:t.passwordConfirm,htmlFor:"passwordConfirm",children:e.jsx(m,{register:r,name:"passwordConfirm",type:"password",required:s("formValidation.mandatory.passwordConfirm"),placeholder:s("passwordConfirm"),trigger:l})}),a&&e.jsx(E,{msg:i==null?void 0:i.message}),e.jsx(y,{type:"submit",disabled:o,addedClassName:"self-center",children:s(o?"signingUp":"signup")})]})};function ne(){const n=h(),{mutate:o,isPending:a}=j({mutationFn:async()=>w.logout(),onSuccess:()=>{n.setQueryData(["loggedInUser"],null)}});return{logout:o,isPendingLogout:a}}const pe=()=>{Q("Roza / Home");const{t:n}=b(),{loggedInUser:o,isLoadingLoggedInUser:a}=G(),{books:i,errorBooks:s,isLoadingBooks:r,isSuccessBooks:u,isErrorBooks:t,isBooksAvailable:l,isNoBooks:c}=O({enabled:!!o,limit:9,sort:"-createdAt"}),g=i==null?void 0:i.sort((U,M)=>new Date(M.createdAt).getTime()-new Date(U.createdAt).getTime()).slice(0,9),{reviews:x,errorReviews:L,isLoadingReviews:v,isSuccessReviews:k,isErrorReviews:B,isNoReviews:P,isReviewsAvailable:R}=z({enabled:!!o,limit:9,sort:"-sortOrder"}),N=x==null?void 0:x.slice(0,9),{logout:q}=ne(),[p,T]=W.useState("login"),I=J(),H=n(p==="login"?"authFormTitle.login":"authFormTitle.signup");function V(){T(p==="login"?"signup":"login")}function A(){o&&I("/profile")}function D(){q()}return e.jsxs(X,{children:[a&&e.jsx(K,{}),!o&&!a&&e.jsxs("section",{className:"mt-12 flex h-full w-11/12 flex-col items-center sm:!w-7/12 md:!w-auto md:min-w-96",children:[p==="login"&&e.jsx(se,{}),p==="signup"&&e.jsx(oe,{}),e.jsxs(Z,{className:"mb-12 mt-4 text-2xl italic text-app-700 md:text-xl",children:[H," ",e.jsx("span",{onClick:V,className:"cursor-pointer text-app-800 hover:underline",children:n(p==="login"?"signup":"login")})]})]}),o&&e.jsxs(Y,{children:[e.jsx(F,{addedClass:"cursor-pointer hover:text-app-800 hover:underline",onClick:A,children:o.username}),e.jsx(f,{}),e.jsx(_,{books:g,errorBooks:s,isLoadingBooks:r,isErrorBooks:t,isSuccessBooks:u,isNoBooks:c,isBooksAvailable:l,isHomePage:!0}),e.jsx(f,{}),e.jsx($,{reviews:N,errorReviews:L,isLoadingReviews:v,isSuccessReviews:k,isErrorReviews:B,isNoReviews:P,isReviewsAvailable:R,isHomePage:!0}),e.jsx(f,{}),e.jsx("div",{className:"flex w-full justify-end",children:e.jsx(y,{onClick:D,children:n("btnLogout")})})]})]})};export{pe as default};
